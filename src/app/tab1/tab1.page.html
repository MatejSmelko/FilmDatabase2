<ion-header class="ion-no-border">
  <ion-toolbar color="dark">
    
    <!-- HEADER: Pokud je přihlášen, zobrazíme info, jinak logo -->
    <ion-buttons slot="start">
      <div class="user-badge" *ngIf="userEmail" (click)="logout()">
        <ion-icon name="log-out-outline" color="secondary"></ion-icon>
        <span class="username">Odhlásit se</span>
      </div>
    </ion-buttons>

    <ion-title class="app-logo ion-text-center" (click)="scrollToTop()">
      <img src="assets/icon/logo.png" alt="MovieDB Logo" class="logo-img"></ion-title>

    <!-- HEADER PRAVÁ STRANA: Přidat film (jen když je přihlášen) -->
    <ion-buttons slot="end">
      <ion-button *ngIf="userEmail" color="secondary" fill="solid" (click)="openAddModal()">
        <ion-icon name="add" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" color="dark">
  
  <!-- HLAVNÍ PŘEPÍNAČ -->
  <div class="segment-container">
    <ion-segment [(ngModel)]="currentView" mode="ios">
      
<ion-segment-button value="collection" *ngIf="userEmail">
        <ion-label>Kolekce</ion-label>
      </ion-segment-button>
      <ion-segment-button value="profile" *ngIf="userEmail">
        <ion-label>Profil</ion-label>
      </ion-segment-button>

      <!-- PRO HOSTY: Login + Register -->
      <ion-segment-button value="login" *ngIf="!userEmail">
        <ion-label>Přihlášení</ion-label>
      </ion-segment-button>
      <ion-segment-button value="register" *ngIf="!userEmail">
        <ion-label>Registrace</ion-label>
      </ion-segment-button>

    </ion-segment>
  </div>



  <!-- 1. VIEW: KOLEKCE FILMŮ -->
  <div *ngIf="currentView === 'collection'" class="fade-in">
    
    <!-- Vyhledávání a filtry -->
    <div class="search-sort-container">
      <ion-searchbar class="custom-search" placeholder="Vyhledat..." color="dark" type="text" (ionInput)="searchMovies($event)"></ion-searchbar>
      <ion-button color="secondary" fill="solid" class="sort-btn" (click)="openSortMenu()">
        <ion-icon slot="icon-only" name="filter"></ion-icon>
      </ion-button>
    </div>

    <!-- Seznam filmů -->
    <ion-grid>
      <ion-row>
        <ion-col size="6" size-md="4" size-lg="3" *ngFor="let m of filteredMovies">
          <ion-card class="movie-card">
            <div class="image-container">
              <img [src]="m.imageUrl" (error)="m.imageUrl='https://placehold.co/400x600/1e1e1e/e91e63?text=No+Image'">
            </div>
            <div class="card-content">
              <h3>{{ m.title }}</h3>
              <div class="meta">
                <span>{{ m.year }}</span>
                <ion-icon name="ellipsis-vertical" class="more-opt" (click)="openOptions(m)"></ion-icon>
              </div>
              <div class="tags"><ion-badge color="medium">{{ m.genre }}</ion-badge></div>
              <div class="rating">
                 <ion-icon *ngFor="let s of [1,2,3,4,5]" [name]="s <= m.rating ? 'star' : 'star-outline'" color="warning"></ion-icon>
              </div>
            </div>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredMovies.length === 0">
      <ion-icon name="videocam-outline" style="font-size: 60px; color: #333;"></ion-icon>
      <p style="color: #666;">Nenašly se žádné filmy.</p>
    </div>
  </div>

<!-- 2. VIEW: PROFILE -->
<div *ngIf="currentView === 'profile' && userEmail" class="auth-wrapper fade-in">
    <div class="auth-box">
      <div class="avatar-circle">
        {{ userEmail.charAt(0).toUpperCase() }}
      </div>
      
      <h2>Vítejte zpátky</h2>
      <p class="subtitle">{{ userEmail }}</p>

      <div class="info-card">
        <ion-item lines="none" color="none">
          <ion-icon name="film-outline" slot="start" color="secondary"></ion-icon>
          <ion-label>
            <h3>Počet filmů</h3>
            <p>{{ movies.length }} filmů v kolekci</p>
          </ion-label>
        </ion-item>
      </div>

      <ion-button expand="block" color="medium" fill="outline" class="logout-btn" (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Odhlásit se
      </ion-button>
    </div>
  </div>
  <!-- 3. VIEW: LOGIN -->
  <div *ngIf="currentView === 'login'" class="auth-wrapper fade-in">
    <div class="auth-box">
      <h2>Vítejte zpátky</h2>
      <p class="subtitle">Přihlaste se ke svému účtu</p>

      <div class="custom-input">
        <ion-icon name="mail-outline" class="input-icon"></ion-icon>
        <ion-input type="email" placeholder="Email" [(ngModel)]="email"></ion-input>
      </div>
      <div class="custom-input">
        <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
        <ion-input type="password" placeholder="Heslo" [(ngModel)]="password"></ion-input>
      </div>

      <ion-button expand="block" color="secondary" class="submit-btn" (click)="submitAuth('login')">
        Přihlásit se
      </ion-button>

      <!-- Hláška pod tlačítkem -->
      <div class="message-box" *ngIf="statusMessage" [ngClass]="statusColor">
        <ion-icon [name]="statusColor === 'danger' ? 'alert-circle' : 'checkmark-circle'"></ion-icon>
        <span>{{ statusMessage }}</span>
      </div>
    </div>
  </div>


  <!-- 4. VIEW: REGISTER -->
  <div *ngIf="currentView === 'register'" class="auth-wrapper fade-in">
    <div class="auth-box">
      <h2>Vytvořit účet</h2>
      <p class="subtitle">Přidej se k nám a začni se svou kolekcí</p>

      <div class="custom-input">
        <ion-icon name="mail-outline" class="input-icon"></ion-icon>
        <ion-input type="email" placeholder="Email" [(ngModel)]="email"></ion-input>
      </div>
      <div class="custom-input">
        <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
        <ion-input type="password" placeholder="Heslo" [(ngModel)]="password"></ion-input>
      </div>

      <ion-button expand="block" color="secondary" class="submit-btn" (click)="submitAuth('register')">
       Zaregistrovat se 
      </ion-button>

      <!-- Hláška pod tlačítkem -->
      <div class="message-box" *ngIf="statusMessage" [ngClass]="statusColor">
        <ion-icon [name]="statusColor === 'danger' ? 'alert-circle' : 'checkmark-circle'"></ion-icon>
        <span>{{ statusMessage }}</span>
      </div>
    </div>
  </div>
