<ion-header class="ion-no-border">
  <ion-toolbar color="dark">
    <ion-title>{{ isEditing ? 'Edit Movie' : 'Add a New Movie' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content color="dark" class="ion-padding">
  <form (ngSubmit)="saveMovie()">
    
    <label>Title</label>
    <div class="custom-input">
      <ion-input [(ngModel)]="movie.title" name="title" placeholder="e.g. The Matrix" required></ion-input>
    </div>

    <label>Description</label>
    <div class="custom-input">
      <ion-textarea [(ngModel)]="movie.description" name="description" rows="3" placeholder="Movie plot..."></ion-textarea>
    </div>

    <ion-row>
      <ion-col size="6">
        <label>Release Year</label>
        <div class="custom-input">
          <ion-input type="number" [(ngModel)]="movie.year" name="year" placeholder="2025" min="1888" max="2099"></ion-input>
        </div>
      </ion-col>
      
      <ion-col size="6" style="position: relative;"> <label>Genre</label>
        <div class="custom-input">
          <ion-input 
            [(ngModel)]="movie.genre" 
            name="genre" 
            (ionInput)="onGenreInput($event)"
            placeholder="Type genre..."
            autocomplete="off">
          </ion-input>
        </div>

        <div class="suggestions-dropdown" *ngIf="showSuggestions">
          <div 
            class="suggestion-item" 
            *ngFor="let g of filteredGenres" 
            (click)="selectGenre(g)">
            {{ g }}
          </div>
        </div>
      </ion-col>
    </ion-row>

<label>Movie Poster</label>
    
    <div class="image-preview" *ngIf="movie.imageUrl" [style.background-image]="'url(' + movie.imageUrl + ')'">
      <div class="remove-btn" (click)="movie.imageUrl = ''">
        <ion-icon name="trash"></ion-icon>
      </div>
    </div>

    <div class="upload-container" *ngIf="!movie.imageUrl">
      <input type="file" accept="image/*" (change)="onFileSelected($event)" #fileInput hidden>
      
      <ion-button expand="block" color="medium" fill="outline" class="dashed-btn" (click)="fileInput.click()">
        <ion-icon name="image-outline" slot="start"></ion-icon>
        Upload form Gallery
      </ion-button>

      <div class="divider">OR PASTE URL</div>

      <div class="custom-input">
        <ion-input [(ngModel)]="movie.imageUrl" name="imageUrl" placeholder="https://..."></ion-input>
      </div>
    </div>

    <label class="rating-label">Rating: {{ movie.rating }}/5</label>
    <div class="star-rating">
      <ion-icon 
        *ngFor="let i of [1,2,3,4,5]" 
        [name]="i <= (movie.rating || 0) ? 'star' : 'star-outline'"
        (click)="setRating(i)"
        color="warning">
      </ion-icon>
    </div>

    <div class="actions">
      <ion-button fill="clear" color="light" (click)="dismiss()">Cancel</ion-button>
      <ion-button type="submit" color="secondary" expand="block">
        {{ isEditing ? 'Save Changes' : 'Create Movie' }}
      </ion-button>
    </div>

  </form>
</ion-content>